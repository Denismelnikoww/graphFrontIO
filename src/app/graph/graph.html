<div class="graph-container">
  <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –≥—Ä–∞—Ñ–æ–≤</h2>

  <div class="main-layout">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –≥—Ä–∞—Ñ -->
    <div class="graph-column">
      <div #graphContainer class="chart-container"></div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="controls-column">
      <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä–∞—Ñ–∞ -->
      <div class="control-group preset-section">
        <h3>–ë—ã—Å—Ç—Ä—ã–µ –≥—Ä–∞—Ñ—ã</h3>

        <div class="preset-selection">
          <div class="preset-info">
            <div class="selected-preset">
              <strong>–í—ã–±—Ä–∞–Ω –≥—Ä–∞—Ñ:</strong> {{ getSelectedPresetName() }}
            </div>
            <div class="preset-description">
              {{ getSelectedPresetDescription() }}
            </div>
          </div>

          <div class="preset-controls">
            <div class="dropdown-container">
              <select [(ngModel)]="selectedPreset" class="preset-dropdown">
                <option *ngFor="let preset of graphPresets" [value]="preset.id">
                  {{ preset.name }}
                </option>
              </select>

              <button (click)="loadPreset()" class="load-preset-button">
                –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="control-group algorithm-section">
        <h3>–ê–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–∞ –≥—Ä–∞—Ñ–∞—Ö</h3>

        <div class="algorithm-selection">
          <div class="algorithm-info">
            <div class="selected-algorithm">
              <strong>–í—ã–±—Ä–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º:</strong> {{ getSelectedAlgorithmName() }}
            </div>
            <div class="algorithm-description">
              {{ getSelectedAlgorithmDescription() }}
            </div>
          </div>

          <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ -->
          <div class="control-group algorithm-selection-section" *ngIf="shouldSelectStartOrEndNode()">
            <h3>–í—ã–±–æ—Ä –≤–µ—Ä—à–∏–Ω –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞</h3>

            <div class="algorithm-node-selection">
              <div class="selection-info">
                <div *ngIf="selectedAlgorithm === 'dijkstra' || selectedAlgorithm === 'bfs'">
                  <p><strong>–î–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ {{ getSelectedAlgorithmName() }}:</strong></p>
                  <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –≤–µ—Ä—à–∏–Ω—É</p>
                  <div *ngIf="selectedStartNodeId" class="selected-node-info">
                    –í—ã–±—Ä–∞–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—à–∏–Ω–∞: <strong>{{ selectedStartNodeId }}</strong>
                  </div>
                </div>

                <div *ngIf="selectedAlgorithm === 'ford-fulkerson'">
                  <p><strong>–î–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –§–æ—Ä–¥–∞-–§–∞–ª–∫–µ—Ä—Å–æ–Ω–∞:</strong></p>
                  <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é (–∏—Å—Ç–æ—á–Ω–∏–∫) –∏ –∫–æ–Ω–µ—á–Ω—É—é (—Å—Ç–æ–∫) –≤–µ—Ä—à–∏–Ω—ã</p>
                  <div *ngIf="selectedStartNodeId || selectedEndNodeId" class="selected-node-info">
                    <div *ngIf="selectedStartNodeId">–ò—Å—Ç–æ—á–Ω–∏–∫: <strong>{{ selectedStartNodeId }}</strong></div>
                    <div *ngIf="selectedEndNodeId">–°—Ç–æ–∫: <strong>{{ selectedEndNodeId }}</strong></div>
                  </div>
                </div>
              </div>

              <button (click)="clearAlgorithmSelection()"
                      [disabled]="!selectedStartNodeId && !selectedEndNodeId"
                      class="clear-algorithm-selection">
                –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä –≤–µ—Ä—à–∏–Ω
              </button>

              <div class="selection-hint">
                <p>üí° <em>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–µ—Ä—à–∏–Ω—ã –≥—Ä–∞—Ñ–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞</em></p>
                <div class="legend">
                  <div class="legend-item">
                    <span class="legend-color" style="background-color: #4CAF50;"></span>
                    <span>–ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—à–∏–Ω–∞</span>
                  </div>
                  <div *ngIf="selectedAlgorithm === 'ford-fulkerson'" class="legend-item">
                    <span class="legend-color" style="background-color: #F44336;"></span>
                    <span>–ö–æ–Ω–µ—á–Ω–∞—è –≤–µ—Ä—à–∏–Ω–∞</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="algorithm-controls">
            <div class="dropdown-container">
              <!-- –ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –±–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ -->
              <select [(ngModel)]="selectedAlgorithm" class="algorithm-dropdown">
                <option *ngFor="let algo of algorithms" [value]="algo.id">
                  {{ algo.name }}
                </option>
              </select>

              <button (click)="solveGraph()" [disabled]="isLoading" class="solve-button">
                @if (isLoading) {
                  <span class="spinner"></span> –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...
                } @else {
                  –†–µ—à–∏—Ç—å
                }
              </button>
            </div>
          </div>

          <div class="results-section" *ngIf="resultGraphs && resultGraphs.length > 0">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h4>
            <div class="result-info">
              <div class="result-description">
                {{ getCurrentResultDescription() }}
              </div>

              <div class="result-navigation">
                <button (click)="showPreviousResult()" [disabled]="resultGraphs.length <= 1">
                  ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π
                </button>
                <span class="result-counter">
                  {{ currentResultIndex + 1 }} / {{ resultGraphs.length }}
                </span>
                <button (click)="showNextResult()" [disabled]="resultGraphs.length <= 1">
                  –°–ª–µ–¥—É—é—â–∏–π ‚Üí
                </button>
              </div>

              <button (click)="clearResults()" class="clear-results">
                –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
              </button>
            </div>
          </div>

          <div class="error-message" *ngIf="errorMessage">
            <div class="error-alert">
              ‚ö†Ô∏è {{ errorMessage }}
            </div>
          </div>
        </div>
      </div>

      <div class="control-group">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—à–∏–Ω–∞–º–∏</h3>
        <button (click)="addNode()">–î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—à–∏–Ω—É</button>
        <button (click)="deleteNode()" [disabled]="selectedNodeIds.length !== 1">
          –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–µ—Ä—à–∏–Ω—É
        </button>
        <button (click)="clearGraph()" class="clear-graph-button">
          –û—á–∏—Å—Ç–∏—Ç—å –≥—Ä–∞—Ñ
        </button>
      </div>

      <div class="control-group">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±—Ä–∞–º–∏</h3>
        <div class="input-group">
          <label>–í–µ—Å –Ω–æ–≤–æ–≥–æ —Ä–µ–±—Ä–∞: </label>
          <input type="number" [(ngModel)]="newEdgeWeight" min="0" max="100" />
        </div>
        <div class="input-group">
          <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ: </label>
          <input type="checkbox" [(ngModel)]="newEdgeDirected" />
        </div>
        <button (click)="addEdge()" [disabled]="selectedNodeIds.length < 2">
          @if (selectedNodeIds.length >= 2) {
            –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ ({{ selectedNodeIds[0] }} ‚Üî {{ selectedNodeIds[1] }})
          } @else {
            –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—Ä–æ (–≤—ã–±–µ—Ä–∏—Ç–µ 2 –≤–µ—Ä—à–∏–Ω—ã)
          }
        </button>

        <div class="edge-controls">
          <div class="selected-edge-info" *ngIf="selectedLinkId">
            <strong>–í—ã–±—Ä–∞–Ω–æ —Ä–µ–±—Ä–æ:</strong> {{ selectedLinkId }}
            <div>–í–µ—Å: {{ getSelectedEdgeWeight() }}</div>
            <div>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ: {{ isEdgeDirected(selectedLinkId) ? '–î–∞' : '–ù–µ—Ç' }}</div>
          </div>

          <button (click)="updateEdgeWeight()" [disabled]="!selectedLinkId">
            –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å —Ä–µ–±—Ä–∞
          </button>
          <button (click)="toggleEdgeDirection()" [disabled]="!selectedLinkId">
            @if (isEdgeDirected(selectedLinkId)) {
              –°–¥–µ–ª–∞—Ç—å –Ω–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º
            } @else {
              –°–¥–µ–ª–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º
            }
          </button>
          <button (click)="deleteEdge()" [disabled]="!selectedLinkId">
            –£–¥–∞–ª–∏—Ç—å —Ä–µ–±—Ä–æ
          </button>
        </div>
      </div>

      <div class="control-group">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–æ–º</h3>
        <button (click)="centerGraph()">–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ</button>
        <button (click)="clearSelection()">–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ</button>
      </div>

      <div class="selection-info">
        @if (selectedNodeIds.length > 0) {
          <div>
            <strong>–í—ã–±—Ä–∞–Ω—ã –≤–µ—Ä—à–∏–Ω—ã:</strong> {{ selectedNodeIds.join(', ') }}
          </div>
        }

        @if (selectedLinkId) {
          <div>
            <strong>–í—ã–±—Ä–∞–Ω–æ —Ä–µ–±—Ä–æ:</strong> {{ selectedLinkId }}
          </div>
        }

        @if (!selectedNodeIds.length && !selectedLinkId) {
          <div>
            –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–µ—Ä—à–∏–Ω—ã –∏–ª–∏ —Ä–µ–±—Ä–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞
          </div>
        }
      </div>
    </div>
  </div>
</div>
